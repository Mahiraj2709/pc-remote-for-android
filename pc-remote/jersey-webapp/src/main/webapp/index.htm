<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script type="text/javascript" language="javascript" src="scripts/jquery-1.4.1-vsdoc.js"></script>
</head>
<body>
    <p id="ptext">
        <label for="text">
            Text:</label>
        <input id="text" name="text" type="text" />
    </p>
    <p>
        <label for="type">
            Type:</label>
        <select id="type">
            <option>Hello</option>
            <option>Bello</option>
        </select>
    </p>
    <a id="add" href="">Add new line</a>
    <div id="main">
    </div>
    <input id="btnSend" type="button" value="Send" />
    <div id="list">
    </div>
    <div id="puffer">
        <table>
        </table>
    </div>
    <script type="text/javascript">
        function htmlEncode(value) {
            return $('<div/>').text(value).html();
        }

        function htmlDecode(value) {
            return $('<div/>').html(value).text();
        }


        var puffer = "<div id=\"puffer\"><table><table></div>";
        var j = new Array();
        i = 0;
        $(document).ready(function () {

//            $.get('http://localhost:8080/jersey-webapp/webresources/layouts/list', function (data) {
//                for (z = 0; z < data.length; z++) {
//                    var item = data[z];
//                    $("#list").append("<p id=\"plist" + z + "\"><a id=\"alistitem" + z + "\"></a></p>");
//                    var listitem = $("#alistitem" + z);
//                    listitem.text(item.name).html();
//                    listitem.click(function (event) {
//                        alert(this.text);
//                        event.preventDefault();
//                    });
//                }

//            });

            /////////////////////////////////////
            // Disable not used elements by type
            //
            $("#type").change(function (event) {
                if (this.value == "Bello") {
                    $("#ptext").hide();
                } else {
                    $("#ptext").show();
                }
            });

            //////////////
            // Send button
            //
            $("#btnSend").click(function (event) {
                var root = $('<rc />');
                $("#main p").each(function (index, p) {
                    root.append($('<row />'));
                });
                var data = $("#puffer").html();
            });

            /////////////////
            // New Row Button
            //
            $("#add").click(function (event) {
                i++;
                $("#main").append(
                    "<p id=\"p" + i + "\">" +
                        "<input id=\"d" + i + "\" name=" + i + " type=\"button\" value=\"Delete\"/>" +
                        "<input id=\"b" + i + "\" name=" + i + " type=\"button\" value=\"Add item\"/>:" +
                    "</p>");

                $("table", puffer).append("<row id=\"r" + i + "\"></row>");

                ///////////////
                // Add new item
                //
                $("#b" + i).click(function (event) {
                    index = event.target.name;
                    if (j[index] == null)
                        j[index] = 1;
                    else
                        j[index]++;

                    var text = htmlEncode($("#text").val());
                    $("#text").val("");
                    var type = htmlEncode($("#type").val());

                    $("#p" + index).append(
                        "<input " +
                            "id=\"btn" + index + "|" + j[index] + "\" " +
                            "name=" + index + "|" + j[index] + " " +
                            "type=\"button\" " +
                            "value=\"" + text + "\"/>");


                    $("#r" + index, puffer).append(
                        "<button " +
                            "id=\"rcbtn" + index + "|" + j[index] + "\" " +
                            "name=" + index + "|" + j[index] + " " +
                            "type=\"" + type + "\" " +
                            "value=\"" + text + "\"/>");

                    ///////////////
                    // Delete Item
                    //
                    $("#btn" + index + "|" + j[index]).click(function (event) {
                        var t = this.name.split("|");
                        $("#btn" + t[0] + "|" + t[1]).remove();

                        $("#rcbtn" + t[0] + "|" + t[1], puffer).remove();
                    });
                });

                //////////////
                // Delete Row 
                //
                $("#d" + i).click(function (event) {
                    $("#p" + this.name).remove();

                    $("#r" + this.name, puffer).remove();
                });
                event.preventDefault();
            });
        })
    </script>
</body>
</html>
