<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script type="text/javascript" language="javascript" src="scripts/jquery-1.4.1-vsdoc.js"></script>
    <style type="text/css">
        #menu ul
        {
            list-style:none;
            float: left;
        }
        #menu li
        {
            float: left;
            margin: 5px 5px 5px 5px;
        }
        #left
        {
            float: left; 
            margin: 10px 50px 50px 50px;
        }
        #right
        {
            float: left;
            margin: 10px 50px 50px 20px;
        }
    </style>
</head>
<body>
    <div id="menu">
        <ul>
            <li><a href="index.htm">Edit</a></li>
            <li><a href="EditLayout.htm">Add new</a></li>
        </ul>
    </div>
    <br style="clear:both" />
    <div id="left">
    </div>
    <div id="right">
        <p>
            <input id="name" type="text" /><input id="itemid" type="hidden" />
        </p>
        <p>
            <textarea id="xml" rows="10" cols="60"></textarea>
        </p>
        <p>
            <input id="btnSave" type="button" value="Save" />
            <input id="btnDelete" type="button" value="Delete" />
        </p>
    </div>
    <div style="clear: both" />
</body>
<script type="text/javascript">
    function htmlEncode(value) {
        return $('<div/>').text(value).html();
    }

    function htmlDecode(value) {
        return $('<div/>').html(value).text();
    }

    var selected;

    $(document).ready(function () {

        //////////////
        // Fill List
        //
        $.get('http://localhost:8080/jersey-webapp/webresources/layouts/list', function (data) {
            for (z = 0; z < data.length; z++) {
                var item = data[z];
                var a = $("<a id=\"alistitem" + z + "\"/>");
                a.text(item.name);
                a.attr("ItemId", item.id);
                a.click(function (event) {
                    var id = $("#" + this.id).attr("ItemId");
                    $.get('http://localhost:8080/jersey-webapp/webresources/layouts/?id=' + id, function (data) {
                        $("#itemid").val(data.id);
                        $("#name").val(data.name);
                        $("#xml").val(data.text);
                    });
                    selected = this.id;

                    event.preventDefault();
                });
                $("#left").append($('<p />').append(a));
            }
        });

        //////////////
        // Save button
        //
        $("#btnSave").click(function (event) {
            var data = new Object();

            data.id = $("#itemid").val();
            data.name = $("#name").val();
            data.text = $("#xml").val();

            $.ajax({
                contentType: 'application/json',
                data: JSON.stringify(data),
                dataType: 'json',
                success: function (data2) {
                    $("#" + selected).text(data.name);
                },
                error: function () {
                    alert("Update Failed");
                },
                processData: false,
                type: 'POST',
                url: 'http://localhost:8080/jersey-webapp/webresources/layouts/'
            });
        });

        //////////////
        // Delete button
        //
        $("#btnDelete").click(function (event) {
            if (selected != null) {
                var id = $("#itemid").val();
                $.ajax({
                    contentType: 'application/json',
                    data: null,
                    dataType: 'json',
                    success: function (data) {
                        $("#" + selected).remove();
                        selected = null;
                        $("#itemid").val('');
                        $("#name").val('');
                        $("#xml").val('');
                    },
                    error: function () {
                        alert("Update Failed");
                    },
                    processData: false,
                    type: 'DELETE',
                    url: 'http://localhost:8080/jersey-webapp/webresources/layouts/?id=' + id
                });
            }
        });
    });
</script>
</html>
